<app-loading [isLoading]="isLoading"></app-loading>
<div [ngClass]="config.theme ? 'theme-' + config.theme : 'default-theme'">
  <!-- CabeÃ§alho com o tÃ­tulo da pÃ¡gina -->
  <h1 class="page-title">{{ pageTitle }}</h1>

  <!-- CabeÃ§alho com aÃ§Ãµes -->
  <div class="header-actions">
    <div class="buttons-area">
      <app-button type="button" class="btn-new" (click)="addRecord()">
        <i class="ph-bold ph-plus"></i>
        <span>Adicionar</span>
      </app-button>

      <app-button *ngIf="config.modal === 'Custom-Userss'" type="button" class="btn-new2" (click)="upload()">
        <i class="ph-bold ph-upload-simple"></i>
        <span>Upload</span>
      </app-button>
    </div>
    <input type="text" placeholder="Buscar registro..." (input)="handleInput($event)" class="search-input"
      aria-label="Buscar registro">
  </div>

  <!-- Tabela de dados -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th *ngFor="let column of columns" (click)="sortData(column)" style="text-align: center;">
            {{ column }}
            <span *ngIf="sortColumn === column">
              {{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}
            </span>
          </th>
          <th class="action-column">AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of paginatedData" [ngClass]="{ 'hover-active': isHovered === row }"
          (mouseenter)="isHovered = row" (mouseleave)="isHovered = null">
          {{ resetAguardando() }} <!-- Reseta a flag apÃ³s exibir o Ã­cone -->
          <!-- Aplica a condiÃ§Ã£o somente se config.modal for 'imports' e apenas na primeira coluna -->
          <td *ngFor="let column of columns; let i = index">
            <span *ngIf="(i === 0 || (i >= 6 && i <= 13)) && 
                         ((config.modal === 'Custom-Users') || 
                          (config.modal === 'Ufs') || 
                          (config.modal === 'processList') || 
                          (config.modal === 'uploads')); else normalContent" [ngClass]="(i === 0) ? {
                    'status-active': row[column] === true || row[column] === 1, 
                    'status-inactive': row[column] === false || row[column] === 0,
                    'status-unknown': row[column] !== true && row[column] !== false && row[column] !== 1 && row[column] !== 0
                  } : {}">

              <!-- Exibe 'Ativo' ou 'Inativo' para a coluna 0 -->
              <ng-container *ngIf="i === 0">
                {{ row[column] === false || row[column] === 0 ? 'Inativo' :
                (row[column] === true || row[column] === 1 ? 'Ativo' : 'Aguard.') }}

                <!-- Chama a funÃ§Ã£o se o valor for "Aguard." -->
                <ng-container
                  *ngIf="row[column] !== true && row[column] !== false && row[column] !== 1 && row[column] !== 0">
                  {{ setAguardando(true) }}
                </ng-container>
              </ng-container>

              <!-- Exibe ðŸš«, âœ… ou um Ã­cone de carregamento para colunas de Ã­ndice 7 a 14 -->
              <ng-container *ngIf="i >= 6 && i <= 13">
                <!-- Ãcone "Aguardando" ðŸ”„ -->
                <ng-container *ngIf="aguardandoFlag; else statusIcons">
                  <span (click)="openMenu(row, column, $event)" class="icon-link">
                    ðŸ”„
                  </span>
                </ng-container>

                <!-- Exibe ðŸš« ou âœ… caso aguardandoFlag seja false -->
                <ng-template #statusIcons>
                  <span (click)="openMenu(row, column, $event)" class="icon-link">
                    <ng-container *ngIf="row[column] === false || row[column] === 0">ðŸš«</ng-container>
                    <ng-container *ngIf="row[column] === true || row[column] === 1">âœ…</ng-container>
                  </span>
                </ng-template>
              </ng-container>

              <div *ngIf="isMenuOpen && selectedRow === row && selectedColumn === column" class="status-menu"
                [ngStyle]="menuPosition" (mouseleave)="closeMenu()">
                <button (click)="updateStatus(true)">âœ… Check</button>
                <button (click)="updateStatus(false)">ðŸš« NÃ£o Check</button>
              </div>


            </span>

            <!-- Exibe o valor normal para outras colunas ou se config.modal for diferente de 'companies' -->
            <ng-template #normalContent>{{ row[column] }}</ng-template>
          </td>
          <!-- BotÃµes de aÃ§Ã£o -->
          <td class="action-buttons" *ngIf="config.modal !== 'uploads' && config.modal !== 'processList'">
            <button class="edit-button" (click)="editRecord(row)" aria-label="Editar registro"
              matTooltip="Editar registro">
              <i class="ph-bold ph-pencil"></i>
            </button>
            <button mat-icon-button class="delete-button" (click)="deleteRecord(row)" aria-label="Deletar registro"
              matTooltip="Deletar registro">
              <i class="ph-bold ph-trash"></i>
            </button>
            <button *ngIf="config.modal === 'imports'" class="aprove-button" (click)="aproveRecord(row)"
              aria-label="Aprovar registro">
              <i class="ph-bold ph-check-fat"></i>
            </button>
          </td>

          <td class="action-buttons" *ngIf="config.modal == 'processList'" style="align-items: center;">
            <button class="upload-button" (click)="editRecord(row)" matTooltip="Importar documentaÃ§Ãµes"
              aria-label="Importar documentaÃ§Ãµes">
              <i class="ph-bold ph-upload"></i>
            </button>
            <button class="printer-button" (click)="editRecord(row)" matTooltip="Imprimir resultado"
              aria-label="Editar registro">
              <i class="ph-bold ph-printer"></i>
            </button>

          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PaginaÃ§Ã£o -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 0" aria-label="PÃ¡gina anterior">Anterior</button>
    <span>PÃ¡gina {{ currentPage + 1 }} de {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage >= totalPages - 1" aria-label="PrÃ³xima pÃ¡gina">PrÃ³xima</button>
  </div>
</div>